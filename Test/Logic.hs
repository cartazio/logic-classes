{-# LANGUAGE FlexibleContexts, FlexibleInstances, MultiParamTypeClasses, OverloadedStrings,
             TypeSynonymInstances, UndecidableInstances #-}
{-# OPTIONS -Wall -Wwarn -fno-warn-name-shadowing -fno-warn-orphans #-}
module Test.Logic (tests) where

--import Debug.Trace
import Control.Monad.Identity (Identity(..), runIdentity)
import Control.Monad.State (MonadState(..), StateT, evalStateT)
--import Data.List (intercalate)
import qualified Data.Set as Set
import Data.String (IsString(fromString))
import Logic.Chiou.NormalForm (toCNFSentence {-, showCNFDerivation-})
import Logic.Instances.Chiou ()
import qualified Logic.Instances.Parameterized as P
import Logic.Instances.PropLogic (flatten)
import Logic.Logic (Logic(..))
import Logic.NormalForm (prenexNormalForm, skolemNormalForm, disjunctiveNormalForm, cnf, implicativeNormalForm)
import Logic.Predicate (Skolem(..), PredicateLogic(..), toPropositional, showForm, freeVars, substitute, convertPred, HasSkolem(..))
import Logic.Satisfiable (clauses, theorem, inconsistant)
import PropLogic (PropForm(..), truthTable)
import qualified TextDisplay as TD
import Test.Chiou (V(..), AtomicFunction(..))
import Test.HUnit

instance Show (P.Formula V String AtomicFunction) where
    show = showForm

{-
data AF = SkolemFunction Int | OtherFunction String deriving (Ord, Eq, Show)

instance IsString AF where
    fromString = OtherFunction

instance Enum AF where
    toEnum = SkolemFunction
    fromEnum (SkolemFunction n) = n
    fromEnum _ = error "AF fromEnum: invalid argument"
-}

{-
type TestFormula = C.Sentence
type TestTerm = C.Term
cf :: AtomicFunction -> AtomicFunction
cf = id
cf' :: AtomicFunction -> AtomicFunction
cf' = id
-}

type TestFormula = P.Formula V String AtomicFunction
type TestTerm = P.Term V AtomicFunction

{-
cf :: AtomicFunction -> AtomicFunction
cf (OtherFunction s) = AtomicFunction s
cf (SkolemFunction n) = AtomicSkolemFunction n
cf' :: AtomicFunction -> AtomicFunction
cf' (AtomicFunction s) = OtherFunction s
cf' (AtomicSkolemFunction n) = SkolemFunction n
-}

--type TestVariable = String
--type TestPredicate = String

tests :: [Test]
tests = precTests ++ cnfTests ++ theoremTests

formCase :: PredicateLogic (P.Formula V String AtomicFunction) (P.Term V AtomicFunction) V String AtomicFunction =>
            String -> TestFormula -> TestFormula -> Test
formCase s expected input = TestCase (assertEqual s expected input)

-- formCaseChiou :: PredicateLogic C.Sentence C.Term String String AtomicFunction =>
--                  String -> TestFormula -> TestFormula -> Test
-- formCaseChiou s expected input = TestCase (assertEqual s expected input)

precTests :: [Test]
precTests =
    [ formCase "prec test 1"
               -- Note that the result of cnf is a conjunction of disjunctions, which
               -- will not group properly without parentheses.
               ((a .&. b) .|. c)
               (a .&. b .|. c)
      -- You can't apply .~. without parens:
      -- :type (.~. a)   -> (FormulaPF -> t) -> t
      -- :type ((.~.) a) -> FormulaPF
    , formCase "prec test 2"
               (((.~.) a) .&. b)
               ((.~.) a .&. b)
    -- I switched the precedence of .&. and .|. from infixl to infixr to get
    -- some of the test cases to match the answers given on the miami.edu site,
    -- but maybe I should switch them back and adjust the answer given in the
    -- test case.
    , formCase "prec test 3"
               ((a .&. b) .&. c) -- infixl, with infixr we get (a .&. (b .&. c))
               (a .&. b .&. c)
    , TestCase (assertEqual "Find a free variable"
                (freeVars (for_all ["x"] (x .=. y) :: TestFormula))
                (Set.singleton "y"))
    , TestCase (assertEqual "Substitute a variable"
                (map sub
                         [ for_all ["x"] (x .=. y) {- :: Formula String String -}
                         , for_all ["y"] (x .=. y) {- :: Formula String String -} ])
                [ for_all ["x"] (x .=. z) :: TestFormula
                , for_all ["y"] (z .=. y) :: TestFormula ])
    ]
    where
      sub f = substitute (head . Set.toList . freeVars $ f) (var "z") f
      a = pApp ("a") []
      b = pApp ("b") []
      c = pApp ("c") []

cnfTests :: [Test]
cnfTests = concatMap pairTest testFormulas ++
           [test9a, moveQuantifiersOut1, skolemize1, skolemize2, skolemize3, inf1]

p :: (IsString t, PredicateLogic formula term v t f) => [term] -> formula
p vs = pApp "p" vs
q :: (IsString t, PredicateLogic formula term v t f) => [term] -> formula
q vs = pApp "q" vs
r :: (IsString t, PredicateLogic formula term v t f) => [term] -> formula
r vs = pApp "r" vs
s :: (IsString t, PredicateLogic formula term v t f) => [term] -> formula
s vs = pApp "s" vs
{-
x' :: IsString v => v
x' = "x"
y' :: IsString v => v
y' = "y"
z' :: IsString v => v
z' = "z"
u' :: IsString v => v
u' = "u"
v' :: IsString v => v
v' = "v"
w' :: IsString v => v
w' = "w"
-}
x :: (PredicateLogic formula term v p f, IsString v) => term
x = var (fromString "x")
y :: (PredicateLogic formula term v p f, IsString v) => term
y = var (fromString "y")
z :: (PredicateLogic formula term v p f, IsString v) => term
z = var (fromString "z")
u :: (PredicateLogic formula term v p f, IsString v) => term
u = var (fromString "u")
v :: (PredicateLogic formula term v p f, IsString v) => term
v = var (fromString "v")
w :: (PredicateLogic formula term v p f, IsString v) => term
w = var (fromString "w")

-- Test cases from http://www.cs.miami.edu/~geoff/Courses/CS63S-09S/Content/FOFToCNF.shtml

type SkolemT = StateT Int

instance HasSkolem (StateT Int Identity) where
    skolem = get >>= \ n -> put (n + 1) >> return n

{-
instance HasSkolem (StateT s Identity) where
    skolem = get >>= \ st -> put (st {C.skolemCount = C.skolemCount st + 1}) >> return (C.skolemCount st)
-}

{-
instance (Enum f) => Skolem (StateT Int Identity) f where
    skolem = get >>= \ n -> put (succ n) >> return (toEnum n)
    oldSkolem n = toEnum n
-}

cnf' :: TestFormula -> PropForm TestFormula
--cnf' f = runIdentity (evalStateT (cnf f) 1)
--cnf' f = toPropositional A (convertPred id id cf' (toCNFSentence (convertPred id id cf f)))
cnf' f = toPropositional A (convertPred id id id (let s = convertPred id id id f in ({-trace (showCNFDerivation s)-} (toCNFSentence s))))

snf' :: TestFormula -> TestFormula
snf' f = runIdentity (evalStateT (skolemNormalForm f :: SkolemT Identity (TestFormula)) 1)

theorem' :: TestFormula -> Bool
theorem' f = runIdentity (evalStateT (theorem f :: SkolemT Identity Bool) 1)

inconsistant' :: TestFormula -> Bool
inconsistant' f = runIdentity (evalStateT (inconsistant f :: SkolemT Identity Bool) 1)

table' :: TestFormula -> [String]
table' f = runIdentity (evalStateT (table f :: SkolemT Identity [String]) 1)

testFormulas :: [(String, PropForm TestFormula, TestFormula)]
testFormulas =
    [ ("cnf test 1",
       CJ [DJ [N (A (pApp ("taller") [var ("y"),fApp (toSkolem 1) [var ("y")]])),A (pApp ("wise") [var ("y")])],DJ [N (A (pApp ("wise") [fApp (toSkolem 1) [var ("y")]])),A (pApp ("wise") [var ("y")])]],
       -- toPropositional A ((((.~.) (taller y xy)) .|. (wise y)) .&. ((.~.) (wise xy) .|. (wise y)) :: TestFormula),
       for_all ["y"] (for_all ["x"] (taller y x .|. wise x) .=>. wise y))
    , ("cnf test 2",
       -- flatten (toPropositional A (((.~.) (pApp "s" [x])) .|. ((.~.) (pApp "q" [x])))),
       DJ [N (A (pApp ("s") [var ("x")])),N (A (pApp ("q") [var ("x")]))],
       ((.~.) (exists ["x"] (pApp "s" [x] .&. pApp "q" [x]))))
    , ("cnf test 3",
       -- flatten (toPropositional A (((.~.) (p [x])) .|. ((q [x]) .|. (r [x])))),
       DJ [N (A (pApp ("p") [var ("x")])),A (pApp ("q") [var ("x")]),A (pApp ("r") [var ("x")])],
       (for_all ["x"] (p [x] .=>. (q [x] .|. r [x]))))
    , ("cnf test 4",
       -- flatten (toPropositional A (p [x] .&. (.~.) (q [y]))),
       CJ [A (pApp ("p") [var ("x")]),N (A (pApp ("q") [var ("y")]))],
       ((.~.) (exists ["x"] (p [x] .=>. exists ["y"] (q [y])))))
    , ("cnf test 5",
       -- flatten (toPropositional A ((((.~.) (q [x])) .|. s [x]) .&. (((.~.) (r [x])) .|. s [x]))),
       CJ [DJ [N (A (pApp ("q") [var ("x")])),A (pApp ("s") [var ("x")])],DJ [N (A (pApp ("r") [var ("x")])),A (pApp ("s") [var ("x")])]],
       (for_all ["x"] (q [x] .|. r [x] .=>. s [x])))
    , let p = pApp "p" [] in
      ("cnf test 6",
       -- flatten (toPropositional A ((.~.) p .|. (f [skX] :: TestFormula))),
       DJ [N (A (pApp ("p") [])),A (pApp ("f") [fApp (SkolemFunction 1) []])],
       (exists ["x"] (p .=>. f [x])))
    , let p = pApp "p" [] in
      ("cnf test 7",
       -- This is what was given by the source
       -- (((.~.) p) .|. f skX .&. p .|. ((.~.) (f skX)))
       -- This is what we are currently getting from our
       -- code, which is different but still may be correct.  However, we may
       --flatten (toPropositional A ((((.~.) p) .|. (f [skX])) .&. (((.~.) (f [skX])) .|. p))),
       CJ [DJ [N (A (pApp ("p") [])),A (pApp ("f") [fApp (SkolemFunction 1) []])],DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) []])),A (pApp ("p") [])]],
       -- (((p []) .|. (p [])) .&. ((((.~.) (f [x])) .|. ((.~.) (f [x]))) .|. (p [])))
       (exists ["x"] (p .<=>. f [x])))
    , ("cnf test 8",
       -- flatten (toPropositional A (((((.~.) (f [x, yOfZ])) .|. (f [x, z])) .&.
       --                              (((.~.) (f [x, yOfZ])) .|. ((.~.) (f [x, x])))) .&.
       --                             ((((.~.) (f [x, z])) .|. (f [x, x])) .|. (f [x, yOfZ])))),
       CJ [DJ [N (A (pApp ("f") [var ("x"),fApp (SkolemFunction 1) [var ("z")]])),A (pApp ("f") [var ("x"),var ("z")])],
           DJ [N (A (pApp ("f") [var ("x"),fApp (SkolemFunction 1) [var ("z")]])),N (A (pApp ("f") [var ("x"),var ("x")]))],
           DJ [N (A (pApp ("f") [var ("x"),var ("z")])),A (pApp ("f") [var ("x"),var ("x")]),A (pApp ("f") [var ("x"),fApp (SkolemFunction 1) [var ("z")]])]],
       (for_all ["z"] (exists ["y"] (for_all ["x"] (f [x, y] .<=>. (f [x, z] .&. ((.~.) (f [x, x]))))))))
    , ("cnf test 9",
{-
       -- This is what we get from the polymorphic code
       CJ [DJ [N (A (pApp ("q") [var ("x"),var ("y")])),N (A (pApp ("f") [var ("z"),var ("x")])),A (pApp ("f") [var ("z"),var ("y")])],
           DJ [N (A (pApp ("q") [var ("x"),var ("y")])),N (A (pApp ("f") [var ("z"),var ("y")])),A (pApp ("f") [var ("z"),var ("x")])],
           DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("x")]),A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("y")]),A (pApp ("q") [var ("x"),var ("y")])],
           DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("y")])),A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("y")]),A (pApp ("q") [var ("x"),var ("y")])],
           DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("x")]),N (A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("x")])),A (pApp ("q") [var ("x"),var ("y")])],
           DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("y")])),N (A (pApp ("f") [fApp (SkolemFunction 1) [var ("x"),var ("x"),var ("y"),var ("z")],var ("x")])),A (pApp ("q") [var ("x"),var ("y")])]],
-}
       CJ [DJ [N (A (pApp ("q") [var (V "x"),var (V "y")])),N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")])),A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")])],
           DJ [N (A (pApp ("q") [var (V "x"),var (V "y")])),N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")])),A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")])],
           DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")]),A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")]),A (pApp ("q") [var (V "x"),var (V "y")])],
           DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")])),A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")]),A (pApp ("q") [var (V "x"),var (V "y")])],
           DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")]),N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")])),A (pApp ("q") [var (V "x"),var (V "y")])],
           DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "y")])),N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "x"),var (V "y"),var (V "z")],var (V "x")])),A (pApp ("q") [var (V "x"),var (V "y")])]],
       (for_all ["x"] (for_all ["x"] (for_all ["y"] (q [x, y] .<=>. for_all ["z"] (f [z, x] .<=>. f [z, y]))))))
    , ("cnf test 10",
{-
       -- This is what we get from the polymorphic code - the place
       -- where we have skolem 3 instead of 2 looks wrong.  And the
       -- missing second skolem function.
       CJ [DJ [A (pApp ("q") [fApp (SkolemFunction 1) [var ("x")],fApp (SkolemFunction 3) [var ("x")],fApp (SkolemFunction 3) [var ("x")]]),
               A (pApp ("p") [var ("x"),fApp (SkolemFunction 1) [var ("x")]])],
           DJ [N (A (pApp ("r") [fApp (SkolemFunction 1) [var ("x")]])),
               A (pApp ("p") [var ("x"),fApp (SkolemFunction 1) [var ("x")]])]]
-}
       CJ [DJ [A (pApp ("q") [fApp (SkolemFunction 1) [var ("x")],fApp (SkolemFunction 2) [var ("x")],fApp (SkolemFunction 3) [var ("x")]]),
               A (pApp ("p") [fApp (SkolemFunction 2) [var ("x")],fApp (SkolemFunction 1) [var ("x")]])],
           DJ [N (A (pApp ("r") [fApp (SkolemFunction 1) [var ("x")]])),
               A (pApp ("p") [fApp (SkolemFunction 2) [var ("x")],fApp (SkolemFunction 1) [var ("x")]])]],
       (for_all ["x"] (exists ["y"] ((p [x, y] .<=. for_all ["x"] (exists ["z"] (q [y, x, z]) .=>. r [y]))))))
    , ("cnf test 11",
       -- This one didn't come with a solution - here's ours
       -- flatten (toPropositional A ((((.~.) (p [x,z])) .|. ((.~.) (q [x,skY [x,z]]))) .&. (((.~.) (p [x,z])) .|. (r [skY [x,z],z])))),
       CJ [DJ [N (A (pApp ("p") [var ("x"),var ("z")])),
               N (A (pApp ("q") [var ("x"),fApp (SkolemFunction 1) [var ("x"),var ("z")]]))],
           DJ [N (A (pApp ("p") [var ("x"),var ("z")])),
               A (pApp ("r") [fApp (SkolemFunction 1) [var ("x"),var ("z")],var ("z")])]],
       (for_all ["x"] (for_all ["z"] (p [x, z] .=>. exists ["y"] ((.~.) (q [x, y] .|. ((.~.) (r [y, z]))))))))
    , let [p, q, r, s, t] = map (\ s -> pApp s []) ["p", "q", "r", "s", "t"] in
      ("cnf test 12",
       CJ [DJ [A (pApp ("p") []),A (pApp ("r") []),A (pApp ("s") [])],
           DJ [N (A (pApp ("q") [])),A (pApp ("r") []),A (pApp ("s") [])],
           DJ [A (pApp ("p") []),A (pApp ("r") []),A (pApp ("t") [])],
           DJ [N (A (pApp ("q") [])),A (pApp ("r") []),A (pApp ("t") [])]],
       -- toPropositional A ((((p.|.(r.|.s)).&.(((.~.) q).|.(r.|.s))).&.((p.|.(r.|.t)).&.(((.~.) q).|.(r.|.t))))),
       ((p .=>. q) .=>. (((.~.) r) .=>. (s .&. t))))
    ]
    where
      y :: TestTerm
      [x, y, z] = map var ["x", "y", "z"]
      taller :: TestTerm -> TestTerm -> TestFormula
      taller a b = pApp "taller" [a, b]
      wise :: TestTerm -> TestFormula
      wise a = pApp "wise" [a]
      -- skX = fApp (toSkolem 1) []
      -- skY = fApp (toSkolem 1)
      -- skZ = fApp (toSkolem 2)
      -- skT = fApp (toSkolem 3)
      f = pApp "f"
      -- g = pApp "g"
      -- h = pApp "h"
      -- t' = fromString "t"
      -- t = var t'
      -- [p, q, r, s, t] = map (\ s -> pApp s []) ["p", "q", "r", "s", "t"]

pairTest :: (String, PropForm TestFormula, TestFormula) -> [Test]
pairTest (s, f1, f2) =
    [ TestCase (assertEqual (s ++ ", Chiou cnf") f1 (flatten (cnf' f2)))
    , TestCase (assertEqual (s ++ ", PredicateLogic cnf")
                f1 (flatten (toPropositional A (runIdentity (evalStateT (cnf f2) (1 :: Int)))))) ]

-- |Here is an example of automatic conversion from a PredicateLogic
-- instance to a PropositionalLogic instance.  The result is PropForm
-- a where a is the original type, but the a values will always be
-- "atomic" formulas, never the operators which can be converted into
-- the corresponding operator of a PropositionalLogic instance.
test9a :: Test
test9a = TestCase 
           (assertEqual "convert to PropLogic"
            expected
            (flatten (cnf' (for_all ["x"] (for_all ["y"] (q [x, y] .<=>. for_all ["z"] (f [z, x] .<=>. f [z, y])))))))
    where
      f = pApp "f"
      q = pApp "q"
      expected :: PropForm TestFormula
      expected = CJ [DJ [N (A (pApp ("q") [var (V "x"),var (V "y")])),
                         N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")])),
                         A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")])],
                     DJ [N (A (pApp ("q") [var (V "x"),var (V "y")])),
                         N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")])),
                         A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")])],
                     DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")]),
                         A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")]),
                         A (pApp ("q") [var (V "x"),var (V "y")])],
                     DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")])),
                         A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")]),
                         A (pApp ("q") [var (V "x"),var (V "y")])],
                     DJ [A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")]),
                         N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")])),
                         A (pApp ("q") [var (V "x"),var (V "y")])],
                     DJ [N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "y")])),
                         N (A (pApp ("f") [fApp (SkolemFunction 1) [var (V "x"),var (V "y"),var (V "z")],var (V "x")])),
                         A (pApp ("q") [var (V "x"),var (V "y")])]]

moveQuantifiersOut1 :: Test
moveQuantifiersOut1 =
    formCase "moveQuantifiersOut1"
             (for_all ["y"] ((pApp ("p") [var ("y")]) .&. ((pApp ("q") [var ("x")]))))
             (prenexNormalForm (for_all ["x"] (pApp (fromString "p") [x]) .&. (pApp (fromString "q") [x])))

skolemize1 :: Test
skolemize1 =
    formCase "skolemize1" expected formula
    where
      expected :: TestFormula
      expected = for_all ["y","z"] (for_all ["v"] (pApp "P" [fApp (toSkolem 1) [], y, z, fApp ((toSkolem 2)) [y, z], v, fApp (toSkolem 3) [y, z, v]]))
      formula :: TestFormula
      formula = (snf' (exists ["x"] (for_all ["y", "z"] (exists ["u"] (for_all ["v"] (exists ["w"] (pApp "P" [x, y, z, u, v, w])))))))

skolemize2 :: Test
skolemize2 =
    formCase "skolemize2" expected formula
    where
      expected :: TestFormula
      expected = for_all [fromString "y"] (pApp ("loves") [fApp (toSkolem 1) [],y])
      formula :: TestFormula
      formula = snf' (exists ["x"] (for_all ["y"] (pApp "loves" [x, y])))

skolemize3 :: Test
skolemize3 =
    formCase "skolemize3" expected formula
    where
      expected :: TestFormula
      expected = for_all [fromString "y"] (pApp ("loves") [fApp (toSkolem 1) [y],y])
      formula :: TestFormula
      formula = snf' (for_all ["y"] (exists ["x"] (pApp "loves" [x, y])))

inf1 :: Test
inf1 =
    formCase "inf1" expected formula
    where
      expected :: TestFormula
      expected = ((pApp ("p") [var ("x")]) .=>. (((pApp ("q") [var ("x")]) .|. ((pApp ("r") [var ("x")])))))
      formula :: TestFormula
      formula = (implicativeNormalForm (for_all ["x"] (p [x] .=>. (q [x] .|. r [x]))))

theoremTests :: [Test]
theoremTests =
    let s = pApp "S"
        h = pApp "H"
        m = pApp "M" in
    [ let formula = for_all ["x"] (((s [x] .=>. h [x]) .&. (h [x] .=>. m [x])) .=>.
                                  (s [x] .=>. m [x])) in
      TestCase (assertEqual "theorem test 1"
                (True,
                 ["+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","| (pApp (\"H\") [var (V \"x\")]) | (pApp (\"M\") [var (V \"x\")]) | (pApp (\"S\") [var (V \"x\")]) | [[[[(pApp (\"S\") [var (V \"x\")]) + (pApp (\"H\") [var (V \"x\")])] + [-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"M\") [var (V \"x\")])]] * [[-(pApp (\"H\") [var (V \"x\")]) + (pApp (\"H\") [var (V \"x\")])] + [-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"M\") [var (V \"x\")])]]] * [[[(pApp (\"S\") [var (V \"x\")]) + -(pApp (\"M\") [var (V \"x\")])] + [-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"M\") [var (V \"x\")])]] * [[-(pApp (\"H\") [var (V \"x\")]) + -(pApp (\"M\") [var (V \"x\")])] + [-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"M\") [var (V \"x\")])]]]] |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |                                                                                                                                                                                                                                                          1                                                                                                                                                                                                                                                          |","+----------------------------+----------------------------+----------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"])
                (theorem' formula, table' formula))
    , TestCase (assertEqual "theorem test 1a"
{-
input:               ((.~.) ((for_all ["x"] (((S [x]) .=>. ((H [x]))) .&. (((H [x]) .=>. ((M [x])))))) .=>. ((for_all ["x"] ((S [x]) .=>. ((M [x])))))))

simplified:          ((.~.) (((.~.) (for_all ["x"] ((((.~.) (S [x])) .|. ((H [x]))) .&. ((((.~.) (H [x])) .|. ((M [x]))))))) .|. ((for_all ["x"] (((.~.) (S [x])) .|. ((M [x])))))))

moveNegationsIn:     ((for_all ["x"] ((((.~.) (S [x])) .|. ((H [x]))) .&. ((((.~.) (H [x])) .|. ((M [x])))))) .&. ((exists ["x"] ((S [x]) .&. (((.~.) (M [x])))))))

moveQuantifiersOut:  (for_all ["x"] (exists ["y"] (((((.~.) (S [x])) .|. ((H [x]))) .&. ((((.~.) (H [x])) .|. ((M [x]))))) .&. (((S [y]) .&. (((.~.) (M [y]))))))))

skolmize:            (((((.~.) (S [x])) .|. ((H [x]))) .&. ((((.~.) (H [x])) .|. ((M [x]))))) .&. (((S [fApp ("Sk(y)") [x]]) .&. (((.~.) (M [fApp ("Sk(y)") [x]]))))))

distributeDisjuncts: (((((.~.) (S [x])) .|. ((H [x]))) .&.
                       ((((.~.) (H [x])) .|. ((M [x]))))) .&.
                      (((S [fApp ("Sk(y)") [x]]) .&.
                        (((.~.) (M [fApp ("Sk(y)") [x]]))))))

distributeDisjuncts: (~S(x) | H(x)) & (~H(x) | M(x)) & S(SkY(x)) & ~M(SkY(x))
-}
                (False,
                 False,
                 ["+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","| (pApp (\"H\") [fApp (SkolemFunction 1) []]) | (pApp (\"M\") [var (V \"y\")]) | (pApp (\"M\") [fApp (SkolemFunction 1) []]) | (pApp (\"S\") [var (V \"y\")]) | (pApp (\"S\") [fApp (SkolemFunction 1) []]) | [[[[(pApp (\"S\") [fApp (SkolemFunction 1) []]) + (pApp (\"H\") [fApp (SkolemFunction 1) []])] + [-(pApp (\"S\") [var (V \"y\")]) + (pApp (\"M\") [var (V \"y\")])]] * [[-(pApp (\"H\") [fApp (SkolemFunction 1) []]) + (pApp (\"H\") [fApp (SkolemFunction 1) []])] + [-(pApp (\"S\") [var (V \"y\")]) + (pApp (\"M\") [var (V \"y\")])]]] * [[[(pApp (\"S\") [fApp (SkolemFunction 1) []]) + -(pApp (\"M\") [fApp (SkolemFunction 1) []])] + [-(pApp (\"S\") [var (V \"y\")]) + (pApp (\"M\") [var (V \"y\")])]] * [[-(pApp (\"H\") [fApp (SkolemFunction 1) []]) + -(pApp (\"M\") [fApp (SkolemFunction 1) []])] + [-(pApp (\"S\") [var (V \"y\")]) + (pApp (\"M\") [var (V \"y\")])]]]] |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     0                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     0                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     0                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     0                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     1                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     1                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     1                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             0              |                     1                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     0                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     0                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     0                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     0                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     1                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     1                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     1                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     0                     |             1              |                     1                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     0                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     0                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     0                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     0                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     1                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     1                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     1                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             0              |                     1                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     0                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     0                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     0                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     0                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     1                     |             0              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     1                     |             0              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     1                     |             1              |                     0                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|                     1                     |             1              |                     1                     |             1              |                     1                     |                                                                                                                                                                                                                                                                                                                      1                                                                                                                                                                                                                                                                                                                      |","+-------------------------------------------+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"])
                
                (let formula = (for_all ["x"] ((s [x] .=>. h [x]) .&. (h [x] .=>. m [x]))) .=>.
                               (for_all ["x"] (s [x] .=>. m [x])) in
                 (theorem' formula, inconsistant' formula, table' formula)))
                
    , TestCase (assertEqual "socrates is mortal, truth table"
                (["+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","| (pApp (\"H\") [var (V \"x\")]) | (pApp (\"H\") [var (V \"y\")]) | (pApp (\"M\") [var (V \"y\")]) | (pApp (\"M\") [var (V \"z\")]) | (pApp (\"S\") [var (V \"x\")]) | (pApp (\"S\") [var (V \"z\")]) | [[[-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"H\") [var (V \"x\")])] * [-(pApp (\"H\") [var (V \"y\")]) + (pApp (\"M\") [var (V \"y\")])]] * [-(pApp (\"S\") [var (V \"z\")]) + (pApp (\"M\") [var (V \"z\")])]] |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             0              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             1              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |             1              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             0              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             1              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |             1              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             0              |             0              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             0              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             1              |             0              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             1              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             1              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |             1              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             0              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             1              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |             1              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             0              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             1              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |             1              |             1              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             0              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             1              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |             1              |             1              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             0              |             0              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             0              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             1              |             0              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             1              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             1              |             1              |             0              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |             1              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             0              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             0              |             0              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             0              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             0              |             1              |             1              |                                                                                            0                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             1              |             0              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             1              |             0              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             1              |             1              |             0              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |             1              |             1              |             1              |                                                                                            1                                                                                             |","+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"])
                -- This formula has separate variables for each of the
                -- three beliefs.  To combine these into an argument
                -- we would wrap a single exists around them all and
                -- remove the existing ones, substituting that one
                -- variable into each formula.
                (table' (for_all ["x"] (s [x] .=>. h [x]) .&.
                         for_all ["y"] (h [y] .=>. m [y]) .&.
                         for_all ["z"] (s [z] .=>. m [z]))))

    , TestCase (assertEqual "socrates is not mortal"
                (False,
                 False,
                 ["+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","| (pApp (\"H\") [var (V \"x\")]) | (pApp (\"M\") [var (V \"x\")]) | (pApp (\"S\") [var (V \"x\")]) | (pApp (\"S\") [fApp (AtomicFunction \"socrates\") []]) | [[[[-(pApp (\"S\") [var (V \"x\")]) + (pApp (\"H\") [var (V \"x\")])] * [-(pApp (\"H\") [var (V \"x\")]) + (pApp (\"M\") [var (V \"x\")])]] * [-(pApp (\"M\") [var (V \"x\")]) + -(pApp (\"S\") [var (V \"x\")])]] * (pApp (\"S\") [fApp (AtomicFunction \"socrates\") []])] |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             0              |                         1                          |                                                                                                                        1                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             0              |             1              |                         1                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             0              |                         1                          |                                                                                                                        1                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |             1              |             1              |                         1                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             0              |                         1                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             0              |             1              |                         1                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             0              |                         1                          |                                                                                                                        1                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |                         0                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |             1              |             1              |                         1                          |                                                                                                                        0                                                                                                                         |","+----------------------------+----------------------------+----------------------------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"],
                 (for_all [fromString "x"]
                  ((((((.~.) (pApp ("S") [var (fromString "x")])) .|. ((pApp ("H") [var (fromString "x")]))) .&.
                     ((((.~.) (pApp ("H") [var (fromString "x")])) .|. ((pApp ("M") [var (fromString "x")]))))) .&.
                    ((((.~.) (pApp ("M") [var (fromString "x")])) .|. (((.~.) (pApp ("S") [var (fromString "x")])))))) .&.
                   ((pApp ("S") [fApp ("socrates") []])))))
                -- This represents a list of beliefs like those in our
                -- database: socrates is a man, all men are mortal,
                -- each with its own quantified variable.  In
                -- addition, we have an inconsistant belief, socrates
                -- is not mortal.  If we had a single variable this
                -- would be inconsistant, but as it stands it is an
                -- invalid argument, there are both 0 and 1 lines in
                -- the truth table.  If we go through the table and
                -- eliminate the lines where S(SkZ(x,y)) is true but M(SkZ(x,y)) is
                -- false (for any x) and those where H(x) is true but
                -- M(x) is false, the remaining lines would all be zero,
                -- the argument would be inconsistant (an anti-theorem.)
                -- How can we modify the formula to make these lines 0?
                (let formula =
                         for_all ["x"] ((s [x] .=>. h [x]) .&.
                                       (h [x] .=>. m [x]) .&.
                                       (m [x] .=>. ((.~.) (s [x])))) .&.
                         (s [fApp "socrates" []]) in
                 (theorem' formula, inconsistant' formula, table' formula, disjunctiveNormalForm formula)))
    , let formula = (for_all [fromString "x"] (pApp "L" [var (fromString "x")] .=>. pApp "F" [var (fromString "x")]) .&. -- All logicians are funny
                     exists [fromString "x"] (pApp "L" [var (fromString "x")])) .=>.                            -- Someone is a logician
                    (.~.) (exists [fromString "x"] (pApp "F" [var (fromString "x")]))                           -- Someone / Nobody is funny
          input = table' formula
          expected = ["+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","| (pApp (\"F\") [var (V \"z\")]) | (pApp (\"F\") [fApp (SkolemFunction 1) []]) | (pApp (\"L\") [var (V \"y\")]) | (pApp (\"L\") [fApp (SkolemFunction 1) []]) | [[[(pApp (\"L\") [fApp (SkolemFunction 1) []]) + -(pApp (\"L\") [var (V \"y\")])] + -(pApp (\"F\") [var (V \"z\")])] * [[-(pApp (\"F\") [fApp (SkolemFunction 1) []]) + -(pApp (\"L\") [var (V \"y\")])] + -(pApp (\"F\") [var (V \"z\")])]] |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     0                     |             0              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     0                     |             0              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     0                     |             1              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     0                     |             1              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     1                     |             0              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     1                     |             0              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     1                     |             1              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             0              |                     1                     |             1              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     0                     |             0              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     0                     |             0              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     0                     |             1              |                     0                     |                                                                                                            0                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     0                     |             1              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     1                     |             0              |                     0                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     1                     |             0              |                     1                     |                                                                                                            1                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     1                     |             1              |                     0                     |                                                                                                            0                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","|             1              |                     1                     |             1              |                     1                     |                                                                                                            0                                                                                                             |","+----------------------------+-------------------------------------------+----------------------------+-------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+"]
      in TestCase (assertEqual "gensler189" expected input)
    ]

{-
theorem5 =
    TestCase (assertEqual "theorm test 2"
              (Just True)
              (theorem ((.~.) ((for_all ["x"] (((s [x] .=>. h [x]) .&.
                                               (h [x] .=>. m [x]))) .&.
                                exists ["x"] (s [x] .&.
                                             ((.~.) (m [x]))))))))
-}

instance TD.Display (TestFormula) where
    textFrame x = [showForm x]
{-
    textFrame x = [quickShow x]
        where
          quickShow =
              foldF (\ _ -> error "Expecting atoms")
                    (\ _ _ _ -> error "Expecting atoms")
                    (\ _ _ _ -> error "Expecting atoms")
                    (\ t1 op t2 -> quickShowTerm t1 ++ quickShowOp op ++ quickShowTerm t2)
                    (\ p ts -> quickShowPred p ++ "(" ++ intercalate "," (map quickShowTerm ts) ++ ")")
          quickShowTerm =
              foldT quickShowVar
                    (\ f ts -> quickShowFn f ++ "(" ++ intercalate "," (map quickShowTerm ts) ++ ")")
          quickShowVar v = show v
          quickShowPred s = s
          quickShowFn (AtomicFunction s) = s
          quickShowOp (:=:) = "="
          quickShowOp (:!=:) = "!="
-}

{-
-- Truth table tests, find a more reasonable result value than [String].

(theorem1a, theorem1b, theorem1c, theorem1d) =
    ( TestCase (assertEqual "truth table 1"
                (Just ["foo"])
                (prepare (for_all ["x"] (((s [x] .=>. h [x]) .&. (h [x] .=>. m [x])) .=>. (s [x] .=>. m [x]))) >>=
                 return . TD.textFrame . truthTable)) )
    where s = pApp "S"
          h = pApp "H"
          m = pApp "M"

type FormulaPF = Formula String String
type F = PropForm FormulaPF

prepare :: FormulaPF -> F
prepare formula = ({- flatten . -} fromJust . toPropositional convertA . cnf . (.~.) $ formula)

convertA = Just . A
-}

table :: (PredicateLogic formula term v p f, Show formula, Ord formula, Eq term, HasSkolem m, Skolem f, IsString v, TD.Display formula) =>
         formula -> m TD.TextFrame
table f = clauses f >>= return . TD.textFrame . truthTable
